<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>Title</title>
    <script type="text/javascript" src="/jquery-easyui/jquery.min.js"></script>
    <script type="text/javascript" src="/jquery-easyui/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="/jquery-easyui/locale/easyui-lang-zh_CN.js"></script>
    <script type="text/javascript" src="/js/jquery.json.js"></script>
    <script type="text/javascript" src="/js/base/common.js?1"></script>
    <script type="text/javascript" src="/js/base/listview.js?1"></script>
    <script type="text/javascript" src="/js/base/fileupload.js"></script>
    <script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"/>
    <script th:inline="javascript">

        wx.config({
            debug: false,
            appId: [[${appId}]],
            timestamp: [[${timestamp}]],
            nonceStr: [[${nonceStr}]],
            signature: [[${signature}]],
            jsApiList: ['chooseWXPay','onMenuShareTimeline', 'onMenuShareAppMessage', 'onMenuShareQQ', 'onMenuShareWeibo', 'onMenuShareQZone'] // 功能列表，我们要使用JS-SDK的什么功能
        });

        function orderPay() {
            ajax({
                url: "/pay/wechat.json",
                data: {
                    orderId: [[${orderId}]]
                },
                success: function (data) {
                    onBridgeReady(data.data);
                }
            })
        }

        function onBridgeReady(data) {
            WeixinJSBridge.invoke(
                'getBrandWCPayRequest', {
                    appId: data.appId,     //公众号名称，由商户传入
                    timeStamp: data.timeStamp,         //时间戳，自1970年以来的秒数
                    nonceStr: data.nonceStr, //随机串
                    package: data.package,
                    signType: "MD5",         //微信签名方式：
                    paySign: data.paySign //微信签名
                },
                function (res) {
                    if (res.err_msg == "get_brand_wcpay_request:ok") {
                    }     // 使用以上方式判断前端返回,微信团队郑重提示：res.err_msg将在用户支付成功后返回    ok，但并不保证它绝对可靠。
                }
            );
        }
        //        if (typeof WeixinJSBridge == "undefined"){
        //            if( document.addEventListener ){
        //                document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);
        //            }else if (document.attachEvent){
        //                document.attachEvent('WeixinJSBridgeReady', onBridgeReady);
        //                document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);
        //            }
        //        }else{
        //            onBridgeReady();
        //        }
    </script>
</head>
<body>
<button type="button" onclick="orderPay()">提交订单</button>
<!--<input type="button" name="提交订单" onclick="orderPay"/>-->
</body>
</html>